version: v1beta11

dependencies:

- name: k3d
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /environments/k3d
    branch: rework

- name: sealed-secrets
  source:
    git: https://github.com/edgefarm/devspace.base
    subPath: /environments/sealed-secrets
    branch: rework

- name: edgefarm-network
  source:
    git: https://github.com/edgefarm/edgefarm.network
    branch: rework

commands:
- name: init
  command: |-
    devspace run update
    devspace run k3d.init
    devspace run sealed-secrets.init

- name: purge
  command: |-
    devspace run k3d.purge

- name: activate
  command: |-
    devspace run k3d.activate

- name: update
  command: |-
    devspace update dependencies

deployments:

- name: cert-manager
  helm:
    chart:
      name: cert-manager
      repo: https://charts.jetstack.io
      version: v1.6.1
    values:
      installCRDs: true
  namespace: cert-manager

- name: vela-system
  kubectl:
    kustomize: true
    kustomizeArgs: ["--enable-helm"]
    manifests:
    - ./dev/manifests/vela-system
  namespace: vela-system

- name: vela-caps
  kubectl:
    kustomize: true
    manifests:
    - ./dev/manifests/vela-caps
  namespace: vela-system

- name: cloud-app
  kubectl:
    kustomize: true
    manifests:
    - ./dev/manifests/applications/cloud-app
  namespace: cloud-app

- name: mixed-app
  kubectl:
    kustomize: true
    manifests:
    - ./dev/manifests/applications/mixed-app
  namespace: mixed-app

- name: mixed-app-network
  kubectl:
    kustomize: true
    manifests:
    - ./dev/manifests/applications/mixed-app-network
  namespace: mixed-app-network
